<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cashiery — نظام كاشير احترافي</title>
    <meta name="description"
        content="نظام نقاط البيع الاحترافي مع دعم ضريبة القيمة المضافة المتوافق مع متطلبات ZATCA في المملكة العربية السعودية">

    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700;800&family=Noto+Nastaliq+Urdu:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="manifest" href="manifest.json">

    <!-- QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/dark.css">
    <link rel="stylesheet" href="css/main.css">

    <style>
        /* Inline critical path fix for flex style */
        .flex-1 {
            flex: 1;
        }

        .mb-4 {
            margin-bottom: 4px;
        }
    </style>
</head>

<body>

    <!-- ═══════════════════════════════════════════════════ -->
    <!-- LOGIN OVERLAY                                       -->
    <!-- ═══════════════════════════════════════════════════ -->
    <div class="login-overlay" id="login-overlay">
        <div class="login-card">
            <div class="login-logo" id="login-logo">C</div>
            <h1 class="text-gradient" id="brand-name-login">Cashiery</h1>
            <p id="login-subtitle">نظام كاشير احترافي — سجّل الدخول للمتابعة</p>

            <div class="form-group">
                <select class="form-control" id="login-username">
                    <option value="" disabled selected>جاري تحميل المستخدمين...</option>
                </select>
            </div>
            <div class="form-group">
                <input type="password" class="form-control" id="login-password" placeholder="كلمة المرور"
                    autocomplete="current-password" onkeydown="if(event.key==='Enter') App.handleLogin();">
            </div>
            <button class="btn btn-primary btn-xl btn-block" onclick="App.handleLogin()" id="login-btn">
                تسجيل الدخول
            </button>
            <p id="login-hint" data-i18n="login_hint"
                style="margin-top: 20px; font-size: 13px; color: var(--text-accent); font-weight: 600;">
                Samir Mohamed | +966568400202
            </p>

            <!-- Language Selector on Login -->
            <div style="margin-top: 16px; display: flex; gap: 8px; justify-content: center;">
                <button class="btn btn-ghost btn-sm lang-btn" onclick="App.switchLanguage('ar')"
                    style="font-size:13px; padding: 6px 12px;">🇸🇦 العربية</button>
                <button class="btn btn-ghost btn-sm lang-btn" onclick="App.switchLanguage('en')"
                    style="font-size:13px; padding: 6px 12px;">🇬🇧 English</button>
                <button class="btn btn-ghost btn-sm lang-btn" onclick="App.switchLanguage('ur')"
                    style="font-size:13px; padding: 6px 12px;">🇵🇰 اردو</button>
            </div>
        </div>
    </div>

    <!-- ═══════════════════════════════════════════════════ -->
    <!-- MAIN APPLICATION                                    -->
    <!-- ═══════════════════════════════════════════════════ -->
    <div id="app" style="display: none;">

        <!-- Sidebar Overlay (click to close on mobile) -->
        <div class="sidebar-overlay" id="sidebar-overlay"></div>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-toggle-pin" onclick="App.toggleSidebar()" title="طي/فرد القائمة (F2)">
                <i class="fas">◀</i>
            </div>
            <div class="sidebar-header">
                <div class="sidebar-logo" id="sidebar-logo">C</div>
                <div class="sidebar-brand">
                    <h2 id="brand-name-sidebar">Cashiery</h2>
                    <span id="brand-subtitle-sidebar">POS System</span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section-title" id="nav-main-label">الرئيسية</div>
                <div class="nav-item active" data-screen="dashboard" onclick="App.navigate('dashboard')">
                    <i>📊</i> <span class="nav-text" data-i18n="dashboard">لوحة التحكم</span>
                </div>
                <div class="nav-item" data-screen="pos" onclick="App.navigate('pos')">
                    <i>🛒</i> <span class="nav-text" data-i18n="pos">شاشة البيع</span>
                </div>
                <div class="nav-item" data-screen="invoices" onclick="App.navigate('invoices')">
                    <i>🧾</i> <span class="nav-text" data-i18n="invoices">الفواتير</span>
                </div>
                <div class="nav-item" data-screen="shifts" onclick="App.navigate('shifts')">
                    <i>⏰</i> <span class="nav-text" data-i18n="shifts">الورديات</span>
                </div>

                <div id="admin-nav">
                    <div class="nav-section-title" id="nav-admin-label">الإدارة</div>
                    <div class="nav-item" data-screen="products" onclick="App.navigate('products')">
                        <i>📦</i> <span class="nav-text" data-i18n="products">المنتجات</span>
                    </div>
                    <div class="nav-item" data-screen="purchases" onclick="App.navigate('purchases')">
                        <i>🚚</i> <span class="nav-text" data-i18n="purchases">المشتريات</span>
                    </div>
                    <div class="nav-item" data-screen="customers" onclick="App.navigate('customers')">
                        <i>👥</i> <span class="nav-text" data-i18n="customers">العملاء</span>
                    </div>
                    <div class="nav-item" data-screen="reports" onclick="App.navigate('reports')">
                        <i>📈</i> <span class="nav-text" data-i18n="reports">التقارير</span>
                    </div>
                    <div class="nav-item" data-screen="settings" onclick="App.navigate('settings')">
                        <i>⚙️</i> <span class="nav-text" data-i18n="settings">الإعدادات</span>
                    </div>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar" id="user-avatar">م</div>
                    <div class="user-details" style="flex:1;">
                        <h4 id="user-name">المستخدم</h4>
                        <span id="user-role">—</span>
                    </div>
                    <button class="btn btn-ghost btn-sm" onclick="Auth.logout()" id="logout-btn" title="تسجيل الخروج"
                        style="padding:6px; border:none;">🚪</button>
                </div>
            </div>
        </aside>

        <!-- ═══════ TOP BAR (hidden by default) ═══════ -->
        <nav class="topbar" id="topbar">
            <div class="topbar-brand">
                <div class="sidebar-logo" id="topbar-logo" style="width:32px; height:32px; font-size:14px;">C</div>
                <span class="topbar-brand-name" id="brand-name-topbar">Cashiery</span>
            </div>
            <div class="topbar-nav" id="topbar-nav">
                <a class="topbar-link active" data-screen="dashboard" onclick="App.navigate('dashboard')">
                    <i>📊</i> <span data-i18n="dashboard">لوحة التحكم</span>
                </a>
                <a class="topbar-link" data-screen="pos" onclick="App.navigate('pos')">
                    <i>🛒</i> <span data-i18n="pos">شاشة البيع</span>
                </a>
                <a class="topbar-link" data-screen="invoices" onclick="App.navigate('invoices')">
                    <i>🧾</i> <span data-i18n="invoices">الفواتير</span>
                </a>
                <a class="topbar-link" data-screen="shifts" onclick="App.navigate('shifts')">
                    <i>⏰</i> <span data-i18n="shifts">الورديات</span>
                </a>
                <a class="topbar-link" data-screen="products" onclick="App.navigate('products')">
                    <i>📦</i> <span data-i18n="products">المنتجات</span>
                </a>
                <a class="topbar-link" data-screen="purchases" onclick="App.navigate('purchases')">
                    <i>🚚</i> <span data-i18n="purchases">المشتريات</span>
                </a>
                <a class="topbar-link" data-screen="customers" onclick="App.navigate('customers')">
                    <i>👥</i> <span data-i18n="customers">العملاء</span>
                </a>
                <a class="topbar-link" data-screen="reports" onclick="App.navigate('reports')">
                    <i>📈</i> <span data-i18n="reports">التقارير</span>
                </a>
                <a class="topbar-link" data-screen="settings" onclick="App.navigate('settings')">
                    <i>⚙️</i> <span data-i18n="settings">الإعدادات</span>
                </a>
            </div>
            <div class="topbar-actions">
                <button class="nav-mode-toggle-btn" onclick="App.toggleNavMode()" title="تبديل إلى القائمة الجانبية"
                    id="nav-mode-btn-top">☰</button>
                <button class="theme-toggle" onclick="App.showLanguageSelector()" title="تغيير اللغة"
                    style="font-size:14px;">🌐</button>
                <button class="theme-toggle" id="theme-toggle-btn-top" onclick="App.toggleTheme()"
                    title="تبديل المظهر">☀️</button>
                <button class="notification-bell" onclick="App.showNotifications()" title="التنبيهات"
                    style="width:36px;height:36px;font-size:16px;">
                    🔔<span class="badge-dot" id="notif-dot-top" style="display:none;"></span>
                </button>
                <button class="btn btn-ghost btn-sm" onclick="Auth.logout()" id="logout-btn-top"
                    title="تسجيل الخروج">🚪</button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <div style="display:flex; align-items:center; gap:12px;">
                    <button class="menu-toggle" onclick="App.toggleSidebar()">☰</button>
                    <h1 id="header-title">📊 لوحة التحكم</h1>
                    <span class="badge badge-success" style="font-size:10px;">v3.3 VAT Update</span>
                </div>
                <div class="header-actions">
                    <span style="font-size: 13px; color: var(--text-muted);" id="header-date"></span>
                    <!-- Nav Mode Toggle -->
                    <button class="nav-mode-toggle-btn" onclick="App.toggleNavMode()" title="تبديل إلى الشريط العلوي"
                        id="nav-mode-btn">≡</button>
                    <!-- Language Selector -->
                    <button class="theme-toggle" onclick="App.showLanguageSelector()" title="تغيير اللغة"
                        style="font-size: 16px;">🌐</button>
                    <button class="theme-toggle" id="theme-toggle-btn" onclick="App.toggleTheme()"
                        title="تبديل المظهر">☀️</button>
                    <button class="notification-bell" onclick="App.showNotifications()" title="التنبيهات">
                        🔔
                        <span class="badge-dot" id="notif-dot" style="display:none;"></span>
                    </button>
                    <button class="btn btn-ghost btn-sm" onclick="App.showKeyboardShortcuts()"
                        title="اختصارات لوحة المفاتيح" style="font-size:16px; padding:10px;">⌨️</button>
                    <div style="width:8px; height:8px; border-radius:50%; background:var(--success);"></div>
                </div>
            </header>
            <div class="content-body" id="content-body">
                <!-- Dynamic content loads here -->
            </div>
        </main>

    </div>

    <!-- ═══════════════════════════════════════════════════ -->
    <!-- MODAL                                               -->
    <!-- ═══════════════════════════════════════════════════ -->
    <div class="modal-overlay" id="modal-overlay" onclick="if(event.target===this) Modal.hide();">
        <div class="modal">
            <div class="modal-header">
                <h2 id="modal-title">عنوان</h2>
                <button class="modal-close" onclick="Modal.hide()">✕</button>
            </div>
            <div class="modal-body" id="modal-body"></div>
            <div class="modal-footer" id="modal-footer"></div>
        </div>
    </div>

    <!-- ═══════════════════════════════════════════════════ -->
    <!-- TOAST NOTIFICATIONS                                -->
    <!-- ═══════════════════════════════════════════════════ -->
    <div class="toast-container" id="toast-container"></div>

    <!-- ═══════════════════════════════════════════════════ -->
    <!-- SCRIPTS                                             -->
    <!-- ═══════════════════════════════════════════════════ -->

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <!-- Scripts -->
    <script src="js/firebase-config.js?v=8"></script>
    <script src="js/i18n.js?v=8"></script>
    <script src="js/utils.js?v=8"></script>
    <script src="js/db.js?v=8"></script>
    <script src="js/auth.js?v=8"></script>
    <script src="js/app.js?v=8"></script>
    <script src="js/dashboard.js?v=8"></script>
    <script src="js/pos.js?v=8"></script>
    <script src="js/products.js?v=8"></script>
    <!-- sales.js removed (does not exist) -->
    <script src="js/reports.js?v=8"></script>
    <script src="js/customers.js?v=8"></script>
    <script src="js/settings.js?v=8"></script>
    <script src="js/invoices.js?v=8"></script>
    <script src="js/receipt.js?v=8"></script>
    <script src="js/shifts.js?v=8"></script> <!-- Added Shifts Module -->
    <script src="js/purchases.js?v=8"></script> <!-- Added Purchases Module -->

    <script src="js/sw-register.js?v=8"></script>

</body>

</html>