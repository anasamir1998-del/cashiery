<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARES Casher Pro â€” Ù†Ø¸Ø§Ù… ÙƒØ§Ø´ÙŠØ± Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
    <meta name="description"
        content="Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ Ù…Ø¹ Ø¯Ø¹Ù… Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© Ø§Ù„Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ù…ØªØ·Ù„Ø¨Ø§Øª ZATCA ÙÙŠ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©">

    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700;800&family=Noto+Nastaliq+Urdu:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="manifest" href="manifest.json">

    <!-- QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/dark.css">
    <link rel="stylesheet" href="css/main.css">

    <style>
        /* Inline critical path fix for flex style */
        .flex-1 {
            flex: 1;
        }

        .mb-4 {
            margin-bottom: 4px;
        }
    </style>
</head>

<body>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- LOGIN OVERLAY                                       -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="login-overlay" id="login-overlay">
        <div class="login-card">
            <div class="login-logo" id="login-logo">A</div>
            <h1 class="text-gradient" id="brand-name-login">ARES Casher Pro</h1>
            <p id="login-subtitle">Ù†Ø¸Ø§Ù… ÙƒØ§Ø´ÙŠØ± Ø§Ø­ØªØ±Ø§ÙÙŠ â€” Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>

            <div class="form-group">
                <input type="text" class="form-control" id="login-username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"
                    autocomplete="username">
            </div>
            <div class="form-group">
                <input type="password" class="form-control" id="login-password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
                    autocomplete="current-password" onkeydown="if(event.key==='Enter') App.handleLogin();">
            </div>
            <button class="btn btn-primary btn-xl btn-block" onclick="App.handleLogin()" id="login-btn">
                ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            </button>
            <p id="login-hint" data-i18n="login_hint"
                style="margin-top: 20px; font-size: 13px; color: var(--text-accent); font-weight: 600;">
                Samir Mohamed | +966568400202
            </p>

            <!-- Language Selector on Login -->
            <div style="margin-top: 16px; display: flex; gap: 8px; justify-content: center;">
                <button class="btn btn-ghost btn-sm lang-btn" onclick="App.switchLanguage('ar')"
                    style="font-size:13px; padding: 6px 12px;">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
                <button class="btn btn-ghost btn-sm lang-btn" onclick="App.switchLanguage('en')"
                    style="font-size:13px; padding: 6px 12px;">ğŸ‡¬ğŸ‡§ English</button>
                <button class="btn btn-ghost btn-sm lang-btn" onclick="App.switchLanguage('ur')"
                    style="font-size:13px; padding: 6px 12px;">ğŸ‡µğŸ‡° Ø§Ø±Ø¯Ùˆ</button>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- MAIN APPLICATION                                    -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="app" style="display: none;">

        <!-- Sidebar Overlay (click to close on mobile) -->
        <div class="sidebar-overlay" id="sidebar-overlay"></div>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-toggle-pin" onclick="App.toggleSidebar()" title="Ø·ÙŠ/ÙØ±Ø¯ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (F2)">
                <i class="fas">â—€</i>
            </div>
            <div class="sidebar-header">
                <div class="sidebar-logo" id="sidebar-logo">A</div>
                <div class="sidebar-brand">
                    <h2 id="brand-name-sidebar">ARES</h2>
                    <span id="brand-subtitle-sidebar">CASHER PRO</span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section-title" id="nav-main-label">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
                <div class="nav-item active" data-screen="dashboard" onclick="App.navigate('dashboard')">
                    <i>ğŸ“Š</i> <span class="nav-text" data-i18n="dashboard">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
                </div>
                <div class="nav-item" data-screen="pos" onclick="App.navigate('pos')">
                    <i>ğŸ›’</i> <span class="nav-text" data-i18n="pos">Ø´Ø§Ø´Ø© Ø§Ù„Ø¨ÙŠØ¹</span>
                </div>
                <div class="nav-item" data-screen="invoices" onclick="App.navigate('invoices')">
                    <i>ğŸ§¾</i> <span class="nav-text" data-i18n="invoices">Ø§Ù„ÙÙˆØ§ØªÙŠØ±</span>
                </div>
                <div class="nav-item" data-screen="shifts" onclick="App.navigate('shifts')">
                    <i>â°</i> <span class="nav-text" data-i18n="shifts">Ø§Ù„ÙˆØ±Ø¯ÙŠØ§Øª</span>
                </div>

                <div id="admin-nav">
                    <div class="nav-section-title" id="nav-admin-label">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
                    <div class="nav-item" data-screen="products" onclick="App.navigate('products')">
                        <i>ğŸ“¦</i> <span class="nav-text" data-i18n="products">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
                    </div>
                    <div class="nav-item" data-screen="purchases" onclick="App.navigate('purchases')">
                        <i>ğŸšš</i> <span class="nav-text" data-i18n="purchases">Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</span>
                    </div>
                    <div class="nav-item" data-screen="customers" onclick="App.navigate('customers')">
                        <i>ğŸ‘¥</i> <span class="nav-text" data-i18n="customers">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span>
                    </div>
                    <div class="nav-item" data-screen="reports" onclick="App.navigate('reports')">
                        <i>ğŸ“ˆ</i> <span class="nav-text" data-i18n="reports">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span>
                    </div>
                    <div class="nav-item" data-screen="settings" onclick="App.navigate('settings')">
                        <i>âš™ï¸</i> <span class="nav-text" data-i18n="settings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
                    </div>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar" id="user-avatar">Ù…</div>
                    <div class="user-details" style="flex:1;">
                        <h4 id="user-name">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h4>
                        <span id="user-role">â€”</span>
                    </div>
                    <button class="btn btn-ghost btn-sm" onclick="Auth.logout()" id="logout-btn" title="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬"
                        style="padding:6px; border:none;">ğŸšª</button>
                </div>
            </div>
        </aside>

        <!-- â•â•â•â•â•â•â• TOP BAR (hidden by default) â•â•â•â•â•â•â• -->
        <nav class="topbar" id="topbar">
            <div class="topbar-brand">
                <div class="sidebar-logo" id="topbar-logo" style="width:32px; height:32px; font-size:14px;">A</div>
                <span class="topbar-brand-name" id="brand-name-topbar">ARES</span>
            </div>
            <div class="topbar-nav" id="topbar-nav">
                <a class="topbar-link active" data-screen="dashboard" onclick="App.navigate('dashboard')">
                    <i>ğŸ“Š</i> <span data-i18n="dashboard">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
                </a>
                <a class="topbar-link" data-screen="pos" onclick="App.navigate('pos')">
                    <i>ğŸ›’</i> <span data-i18n="pos">Ø´Ø§Ø´Ø© Ø§Ù„Ø¨ÙŠØ¹</span>
                </a>
                <a class="topbar-link" data-screen="invoices" onclick="App.navigate('invoices')">
                    <i>ğŸ§¾</i> <span data-i18n="invoices">Ø§Ù„ÙÙˆØ§ØªÙŠØ±</span>
                </a>
                <a class="topbar-link" data-screen="shifts" onclick="App.navigate('shifts')">
                    <i>â°</i> <span data-i18n="shifts">Ø§Ù„ÙˆØ±Ø¯ÙŠØ§Øª</span>
                </a>
                <a class="topbar-link" data-screen="products" onclick="App.navigate('products')">
                    <i>ğŸ“¦</i> <span data-i18n="products">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
                </a>
                <a class="topbar-link" data-screen="purchases" onclick="App.navigate('purchases')">
                    <i>ğŸšš</i> <span data-i18n="purchases">Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</span>
                </a>
                <a class="topbar-link" data-screen="customers" onclick="App.navigate('customers')">
                    <i>ğŸ‘¥</i> <span data-i18n="customers">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span>
                </a>
                <a class="topbar-link" data-screen="reports" onclick="App.navigate('reports')">
                    <i>ğŸ“ˆ</i> <span data-i18n="reports">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span>
                </a>
                <a class="topbar-link" data-screen="settings" onclick="App.navigate('settings')">
                    <i>âš™ï¸</i> <span data-i18n="settings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
                </a>
            </div>
            <div class="topbar-actions">
                <button class="nav-mode-toggle-btn" onclick="App.toggleNavMode()" title="ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©"
                    id="nav-mode-btn-top">â˜°</button>
                <button class="theme-toggle" onclick="App.showLanguageSelector()" title="ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©"
                    style="font-size:14px;">ğŸŒ</button>
                <button class="theme-toggle" id="theme-toggle-btn-top" onclick="App.toggleTheme()"
                    title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¸Ù‡Ø±">â˜€ï¸</button>
                <button class="notification-bell" onclick="App.showNotifications()" title="Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª"
                    style="width:36px;height:36px;font-size:16px;">
                    ğŸ””<span class="badge-dot" id="notif-dot-top" style="display:none;"></span>
                </button>
                <button class="btn btn-ghost btn-sm" onclick="Auth.logout()" id="logout-btn-top"
                    title="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬">ğŸšª</button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <div style="display:flex; align-items:center; gap:12px;">
                    <button class="menu-toggle" onclick="App.toggleSidebar()">â˜°</button>
                    <h1 id="header-title">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
                </div>
                <div class="header-actions">
                    <span style="font-size: 13px; color: var(--text-muted);" id="header-date"></span>
                    <!-- Nav Mode Toggle -->
                    <button class="nav-mode-toggle-btn" onclick="App.toggleNavMode()" title="ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ"
                        id="nav-mode-btn">â‰¡</button>
                    <!-- Language Selector -->
                    <button class="theme-toggle" onclick="App.showLanguageSelector()" title="ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©"
                        style="font-size: 16px;">ğŸŒ</button>
                    <button class="theme-toggle" id="theme-toggle-btn" onclick="App.toggleTheme()"
                        title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¸Ù‡Ø±">â˜€ï¸</button>
                    <button class="notification-bell" onclick="App.showNotifications()" title="Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª">
                        ğŸ””
                        <span class="badge-dot" id="notif-dot" style="display:none;"></span>
                    </button>
                    <button class="btn btn-ghost btn-sm" onclick="App.showKeyboardShortcuts()"
                        title="Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­" style="font-size:16px; padding:10px;">âŒ¨ï¸</button>
                    <div style="width:8px; height:8px; border-radius:50%; background:var(--success);"></div>
                </div>
            </header>
            <div class="content-body" id="content-body">
                <!-- Dynamic content loads here -->
            </div>
        </main>

    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- MODAL                                               -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="modal-overlay" id="modal-overlay" onclick="if(event.target===this) Modal.hide();">
        <div class="modal">
            <div class="modal-header">
                <h2 id="modal-title">Ø¹Ù†ÙˆØ§Ù†</h2>
                <button class="modal-close" onclick="Modal.hide()">âœ•</button>
            </div>
            <div class="modal-body" id="modal-body"></div>
            <div class="modal-footer" id="modal-footer"></div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- TOAST NOTIFICATIONS                                -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="toast-container" id="toast-container"></div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- SCRIPTS                                             -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <script src="js/i18n.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/db.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/app.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/pos.js"></script>
    <script src="js/products.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/purchases.js?v=3.0"></script>
    <script src="js/reports.js?v=2.8"></script>
    <script src="js/shifts.js?v=2.9"></script>
    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ar.js"></script>

    <script src="js/customers.js"></script>
    <script src="js/invoices.js?v=2.0"></script>
    <script src="js/receipt.js"></script>
    <script src="js/reports.js"></script>
    <script src="js/shifts.js"></script>
    <script src="js/settings.js"></script>

    <!-- Update header date -->
    <script>
        (function updateHeaderDate() {
            const el = document.getElementById('header-date');
            if (el) {
                const now = new Date();
                const locale = I18n.currentLang === 'ur' ? 'ur-PK' : I18n.currentLang === 'en' ? 'en-US' : 'ar-SA';
                el.textContent = now.toLocaleDateString(locale, {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }
            setInterval(updateHeaderDate, 60000);
        })();
    </script>

    <!-- BULLETPROOF BRANDING: Apply saved company name & logo everywhere -->
    <script>
        (function applyBrandingNow() {
            try {
                // Read settings directly from localStorage
                var raw = localStorage.getItem('ares_pos_settings');
                if (!raw) return;
                var settings = JSON.parse(raw);
                if (!settings || !Array.isArray(settings)) return;
                // Settings logic...
            } catch (e) { }
        })();
    </script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>

    function getSetting(key, def) {
    var s = settings.find(function (item) { return item.key === key; });
    return s ? s.value : def;
    }

    var name = getSetting('company_name', '');
    var nameEn = getSetting('company_name_en', '');
    var logo = getSetting('company_logo', '');

    if (!name && !nameEn && !logo) return; // nothing custom saved

    // Apply to all brand text elements
    var loginBrand = document.getElementById('brand-name-login');
    var sidebarBrand = document.getElementById('brand-name-sidebar');
    var sidebarSub = document.getElementById('brand-subtitle-sidebar');
    var topbarBrand = document.getElementById('brand-name-topbar');

    if (loginBrand && name) loginBrand.textContent = name + (nameEn ? ' ' + nameEn : '');
    if (sidebarBrand && name) sidebarBrand.textContent = name;
    if (sidebarSub) sidebarSub.textContent = nameEn || '';
    if (topbarBrand && name) topbarBrand.textContent = name;

    // Apply logo to all logo elements
    var logoEls = [
    document.getElementById('login-logo'),
    document.getElementById('sidebar-logo'),
    document.getElementById('topbar-logo')
    ];

    logoEls.forEach(function (el) {
    if (!el) return;
    if (logo) {
    el.innerHTML = '<img src="' + logo + '" style="width:100%;height:100%;object-fit:contain;border-radius:inherit;"
        alt="logo">';
    el.style.background = 'transparent';
    el.style.boxShadow = 'none';
    } else if (name || nameEn) {
    var letter = ((nameEn || name || 'A') + '').charAt(0).toUpperCase();
    el.innerHTML = letter;
    el.style.background = '';
    el.style.boxShadow = '';
    }
    });

    // Update title
    if (name) document.title = name + (nameEn ? ' â€” ' + nameEn : '');
    } catch (e) {
    console.error('[Branding] Error:', e);
    }
    })();

    // Also re-apply after short delays to catch any late renders
    setTimeout(function () {
    if (window.Settings && Settings.applyShopName) Settings.applyShopName();
    }, 300);
    setTimeout(function () {
    if (window.Settings && Settings.applyShopName) Settings.applyShopName();
    }, 1000);
    </script>
</body>

</html>